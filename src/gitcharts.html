<!DOCTYPE html><!-- (c) 2015-2016 Briskat, http://www.briskat.com, License: MIT -->
<html lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta http-equiv="cache-control" content="max-age=0">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="expires" content="Tue, 01 Jan 1970 1:00:00 GMT">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Git analytics. Interactive and online.">
	<meta name="author" content="Briskat">
	<meta property="og:image" content="http://www.briskat.com/img/gcharts.png">
	<meta name="og:description" content="Git analytics. Interactive and online">
	<meta name="og:title" content="Gitcharts">
	<meta name="og:type" content="website">
	<title>Briskat - Gitcharts</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<script type="text/javascript">
	google.load('visualization', '1.0', {'packages':['corechart','table']});
	google.setOnLoadCallback(initMe);

	var GS = new Array(); // reuse graph
	var S = { tab : 'cact',
			term : thisMonth()
		};

	var _blank = {textPosition : "none"};
	var Conf = {
		'cact' : [
			[
				"/r/commits_mo",
				[
					[ 'Area', 'cact_d1', {_t: 'Commit activity',vAxis: {minValue: 0}, isStacked: true }, [['month','regular','merge']],,, dateListener  ]
				]
			],
			[
				"/r/commits_summary?d=%m",
				[
					[ 'Column', 'cact_d2', {_t: 'Commits, %m', hAxis: _blank, isStacked: true}, [['date','regular','merge']],[1,2] ],
					[ 'Area', 'cact_d3', {_t: 'Changed size, %m', hAxis: _blank }, [['date','bytes']], [3] ],
					[ 'Area', 'cact_d4', {_t: 'Lines, %m', hAxis: _blank,colors: ["green","red"] }, [['date','added','deleted']], [4,5] ]
				]
			],
			[
				"/r/files_summary?d=%m",
				[
					[ 'Area', 'cact_d5', {_t: 'Files, %m', hAxis: _blank, colors:["green","red","#3366CC"] }, [['Date','added','deleted','changed']],[1,2,3] ]
				]
			]
		],
		'csum' : [
			[
				"/r/commits_mo",
				[
					[ 'Area', 'csum_d7', {_t: 'Commit activity',vAxis: {minValue: 0}, isStacked: true }, [['month','regular','merge']] ],
					[ 'Area', 'csum_d8', {_t:'Total commit activity', vAxis: {minValue: 0}, isStacked: true }, [['month','regular','merge']],, run_sum ]
				]
			],
			[
				"/r/summary",
				[ [ 'oneNumber', tHeadSum, [ "span#csum_d1","span#csum_d3","span#csum_d5","span#csum_d6" ] ] ]
			],
			[
				"/r/commits_comtype",
				[ [ 'oneNumber', tMerge, [ "span#csum_d2" ] ] ]
			],
			[
				"/r/authors_comtype",
				[ [ 'oneNumber', tMerge, [ "span#csum_d4" ] ] ]
			]
		],
		'conact' : [
			[
				"/r/commit_authors",
				[
					[ 'Area', 'conact_d1', {_t:'Commit & contributor activity',colors: ["#3366CC","purple"] }, [['month','commits','contributors']],,, dateListener  ],
				]
			],
			[
				"/r/authors_summary?d=%m&dto=%tn",
				[
					[ 'Bubble', 'conact_d2',
						function (data,month,tn) {
							var min=max=data[0][3];
							for (var i = 0; i < data.length; i++) {
								if ( data[i][3] < min ) {
									min = data[i][3];
								}
								if ( data[i][3] > max ) {
									max = data[i][3];
								}
							}
							return {
									hAxis: {title: 'lines added'},
									vAxis: {title: 'lines removed'},
									title: month + tn + ' top commit contributors correlated with changed size and lines',
									colors: get_red_green(min,max),
									explorer: { maxZoomOut: 20 },
									animation:{
										 duration: 900,
										 easing: 'out'
									},
								};
						},
						[['author','lines added','lines deleted','bytes changed','commits']]
					]
				]
			]
		],
		'concom' : [
			[
				"/r/commit_authors",
				[
					[ 'Area', 'concom_d1', {_t:'Commit & contributor activity',colors: ["#3366CC","purple"] }, [['month','commits','contributors']],,, dateListener  ],
				]
			],
			[
				"/r/authors_rcommits?d=%m&dto=%tn",
				[
					[ 'Pie', 'concom_d2', {_t : '%m%tn regular commit contributors' },
						[['Contributor','regular commits']],,
						function (mydata) { var col1=order_by_col(1);mydata.sort(col1); return mydata }
					]
				],
			],
			[
				"/r/authors_mcommits?d=%m&dto=%tn",
				[
					[ 'Pie', 'concom_d3', {_t : '%m%tn merge commit contributors' },
						[['Contributor','merge commits']],,
						function (mydata) { var col1=order_by_col(1);mydata.sort(col1); return mydata }
					]
				]
			]
		],
		'conlin' : [
			[
				"/r/commit_authors",
				[
					[ 'Area', 'conlin_d1', {_t:'Commit & contributor activity',colors: ["#3366CC","purple"] }, [['month','commits','contributors']],,, dateListener  ],
				]
			],
			[
				"/r/authors_lines?d=%m",
				[
					[ 'Column', 'conlin_d2', {_t: '%m top contributors by total no. of changed lines', colors:["green","red"] },
						[['Contributor','lines added','lines deleted']],,
						function (mydata) { mydata.sort(order_2valsum); return chop(mydata,8) }
					]
				]
			]
		],
		'conaut' : [
			[
				"/r/commit_authors",
				[
					[ 'Area', 'conaut_d1', {_t:'Commit & contributor activity',colors: ["#3366CC","purple"] }, [['month','commits','contributors']],,, dateListener  ],
				]
			],
			[
				"/r/authors_size?d=%m",
				[
					[ 'Column', 'conaut_d2', {_t: '%m top contributors by size changed' },
						[['contributor','bytes']],,
						function (mydata) { mydata.sort(order_abs); return chop(mydata,12) }
					]
				]
			]
		],
		'connew' : [
			[
				"/r/newcommers_mo",
				[
					[ 'Area', 'connew_d1', {_t: 'Contributors and newcomers', colors: ["purple","sienna"]}, [['Date','contributors','newcomers']],,, dateListener ]
				]
			],
			[
				"/r/newcommers?d=%m",
				[ [ 'oneNumber', newCommiters, [ "span#connew_d2" ] ] ]
			]
		],
		'lact' : [
			[
				"/r/lines_mo",
				[
					[ 'Area', 'lact_d1', {_t: 'Line additions, removals', colors:["green","red"], vAxis: {minValue: 0}}, [['Date','lines added', 'lines deleted']],,, dateListener ]
				]
			],
			[
				"/r/lines_date?d=%m",
				[
					[ 'Column', 'lact_d2', {_t: '%m line additions, removals', colors:["green","red"], hAxis: _blank}, [['Date','lines added', 'lines deleted']],,, dateListener ],
				]
			],
			[
				"/r/lines_commit?d=%d",
				[
					[ 'Column', 'lact_d3',
						{_t : '%d top commits by total changed lines', colors:["green","red"]  },
						[['commit','lines added', 'lines deleted']],
						,
						function (mydata) { mydata.sort(order_2valsum); return chop(mydata,12) },
						commitListener
					]
				]
			]
		],
		'fact' : [
			[
				"/r/files_added_mo",
				[
					[ 'Area', 'fact_d1', {_t:'File addition activity', colors:["green","red"]}, [['Date','files added','files deleted']],,, dateListener1 ],
					[ 'Area', 'fact_d2', {_t:'Total files'}, [['Date','total files']],, run_sum_files, dateListener ]
				]
			],
			[
				"/r/files_added_date?d=%m",
				[
					[ 'Column', 'fact_d3', {_t: '%m file additions, removals', colors:["green","red"], hAxis: _blank }, [['Date','added files','deleted files']],,, dateListener ],
				]
			],
			[
				"/r/files_added_commit?d=%d",
				[
					[ 'Column', 'fact_d4',
						{_t : '%d top commits by file additions', colors:["green","red"]  },
						[['commit','added files','deleted files']],
						,
						function (mydata) { mydata.sort(order_2valsum); return chop(mydata,12) },
						commitListener
					]
				]
			]
		],
		'fmodcom' : [
			[
				"/r/files_changed_mo",
				[
					[ 'Area', 'fmodcom_d1', {_t: 'Changed files', vAxis: {minValue: 0}}, [['Date','changed files']],,, dateListener ]
				]
			],
			[
				"/r/files_changed_date?d=%m",
				[
					[ 'Area', 'fmodcom_d2', {_t: '%m changed files', hAxis: _blank}, [['Date','changed files']],,, dateListener ],
				]
			],
			[
				"/r/files_changed_commit?d=%d",
				[
					[ 'Column', 'fmodcom_d3',
						{_t : '%d top commits by changed files'  },
						[['commit','changed files']],
						,
						function (mydata) { mydata.sort(order_abs); return chop(mydata,12) },
						commitListener
					]
				]
			]
		],
		'fmodfil' : [
			[
				"/r/files_changed_mo",
				[
					[ 'Area', 'fmodfil_d1', {_t: 'Changed files', vAxis: {minValue: 0}}, [['Date','changed files']],,, dateListener ]
				]
			],
			[
				"/r/files_changed_date?d=%m",
				[
					[ 'Area', 'fmodfil_d2', {_t: '%m changed files', hAxis: _blank}, [['Date','changed files']],,, dateListener ],
				]
			],
			[
				"/r/files_changed?d=%d",
				[
					[ 'Column', 'fmodfil_d3',
						{_t : '%m most changed files'  },
						[['file name','no. of changes']],
						,
						function (mydata) { mydata.sort(order_abs); return chop(mydata,12) }
					]
				],
			]
		],
		'sact' : [
			[
				"/r/size_mo",
				[
					[ 'Area', 'sact_d1', {_t:'Changed size'}, [['Date','bytes']],,, dateListener1 ],
					[ 'Area', 'sact_d2', {_t:'Total size'}, [['Date','bytes']],, run_sum, dateListener ]
				]
			],
			[
				"/r/size_date?d=%m",
				[
					[ 'Area', 'sact_d3', {_t: 'Changed size, %m', hAxis: _blank}, [['Date','bytes']],,, dateListener ],
				]
			],
			[
				"/r/size_commit?d=%d",
				[
					[ 'Column' , 'sact_d4',
						{_t : '%d top commits by bytes changed' },
						[['Commit','bytes']],
						,
						function (mydata) { mydata.sort(order_abs); return chop(mydata,12) },
						commitListener
					]
				],
			]
		],
		'stype' : [
			[
				"/r/size_yr_ft",
				[
					[ 'Area', 'stype_d1', {_t: 'Size in bytes by file type', isStacked : true, _stack: 1 },,,run_sum ]
				]
			],
			[
				"/r/size_suffix",
				[
					[ 'Pie', 'stype_d2',{_t: 'Approximate total size in bytes by file extension'}, [['Suffix','bytes']],,
						function (mydata) { var col1=order_by_col(1);mydata.sort(col1); return mydata } ]
				]
			],
			[
				"/r/size_ft",
				[
					[ 'Pie', 'stype_d3',{_t: 'Approximate total size in bytes by file type', hAxis: _blank}, [['File Type','bytes']],,
						function (mydata) { var col1=order_by_col(1);mydata.sort(col1); return mydata } ]
				]
			]
		]
	};

	function rgb(ratio,base) {
			var red,green,blue;
			if ( ratio < 0 ) {
				ratio = base + ratio;
				red = Math.round(255-16*ratio/base);
				green = Math.round(230*ratio/base);
				blue = Math.round(220*ratio/base);
			} else {
				red = Math.round(239-ratio*222/base);
				green = Math.round(230-ratio*80/base);
				blue = Math.round(220-ratio*195/base);
			}
			green = green.toString(16);
			blue = blue.toString(16);
			if ( green.length < 2 ) {
				green = '0' + green;
			}
			if ( blue.length < 2 ) {
				blue = '0' + blue;
			}
			return '#' + red.toString(16) + green + blue;
	}

	function get_red_green(min,max) {
		var from,zero,to,base=255;
		if ( Math.abs(min) > Math.abs(max) ) {
			from = "#ff0000";
			abs_max=Math.abs(min);
			ratio=Math.round(max*base/Math.abs(abs_max))
			to = rgb(ratio,base);
		} else {
			if ( max == 0 ) {
				to=from='#efe6dc';
			} else {
				to = "#119719";
				abs_max=Math.abs(max);
				ratio=Math.round(min*base/Math.abs(abs_max))
				from = rgb(ratio,base);
			}
		}
		return [from,to];
	}

	function initMe() {
		var tab=getUrlParameter('t');
		if ( tab in Conf ) { S['tab']=tab; }
		S['term']=parse_date(getUrlParameter('d'));
		$("#when_opt").change(function() { refresh(S['term'],1); });
		loadProjects();

		$("#r"+S['tab']).tab('show');
		$(window).resize(function(){ refresh(S['term']); });
		$("#project_div").change(function() { refresh(S['term']); });
		$("#link_btn").click(function() { prompt('Paste current URL', getCurUrl()) });
		// FIXME only when collapsed (otherwise toolbar is blinking)
		// $('.nav a').on('click', function(){ $('.navbar-toggle').click() });

		$(document).ready(function(){
			$('a[data-toggle="tab"]').on('shown.bs.tab', function(e){
				var act = $(e.target).attr('href'); // Get the name of active tab
				S['tab'] = act.substring(1, act.length);
				$("#r"+S['tab']).tab('show');
				if ( S['tab'] == 'conact' || S['tab'] == 'concom' ) {
					$("#btntab0").show();
					$("#btntab1").show();
				} else {
					$("#btntab0").hide();
					$("#btntab1").hide();
				}
				refresh(S['term']);
			});
		});
		refresh(S['term']);
	//	jQuery(document).ready(function(e) { jQuery('#help_btn').trigger('click'); });
	}

	function getCurUrl() {
		var cUrl = "?proj=" + encodeURIComponent(getActiveProject()) + "&d=" + S['term'] + "&t=" + S['tab'];

		var base = window.location.href
		if (base.indexOf("?")>-1){
			base = base.substr(0,base.indexOf("?"));
		}
		return base + cUrl.substring(0, cUrl.length);
	}

	function dump(obj) {
		prompt('Dump', JSON.stringify(obj));
	}
	function today() {
		var dat = new Date(), d = dat.getDate(), m = dat.getMonth()+1;
		return dat.getFullYear() + (m < 10 ? '-0' : '-') + m + (d < 10 ? '-0' : '-') + d;
	}
	function thisMonth() {
		var dat = new Date(), m = dat.getMonth()+1;
		return dat.getFullYear() + (m < 10 ? '-0' : '-') + m;
	}
	function parse_date(term) {
		if ( term == null ) { return thisMonth() }
		return ( new Date(term).getFullYear() > 0 && term.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/)
					&& term.match(/^(\d{4})-(\d{1,2})$/) )
				? thisMonth()
				: term;
	}
	}

	function getUrlParameter(sParam,Url) {
		var sPageURL = window.location.search.substring(1);
		if ( Url ) { sPageURL = Url; }
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++) {
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] == sParam) {
				return  decodeURIComponent(sParameterName[1]);
			}
		}
	}

	function loadProjects() {
		var jsonData = getData("/api/p/");
		var options = $("#project_div");
		var proj=getUrlParameter('proj');
		$.each(jsonData['projects'], function() {
			if ( this.name == proj ) {
				options.append($("<option selected/>").val(this.name).text(this.name));
			} else {
				options.append($("<option />").val(this.name).text(this.name));
			}
		});
	}

	function getData(url) {
		return $.ajax({
			url: url,
			dataType: "json",
			async: false,
			error:function () {
				alert('Error: cannot retrieve data.\n\nPlease try again later or report a bug.')
			}
		}).responseJSON;
	}

	function order_alpha(idx) {
		return function (a, b) {
			A = a[idx].toUpperCase();
			B = b[idx].toUpperCase();
			return A == B ? 0
				: B > A ? 1
					: -1;
		}
	}
	function order_by_col(idx) {
		return function (a, b) {
			return b[idx] == a[idx] ? 0
				: b[idx] > a[idx] ? 1
					: -1;
		}
	}
	function order_abs(a, b) {
		return Math.abs(b[1]) == Math.abs(a[1]) ? 0
			: Math.abs(b[1]) > Math.abs(a[1]) ? 1
			: -1;
	}
	// FIXME doesn't sort [['d',4,1],['a',4,4]]
	function order_2val(a, b) {
		return ( b[1] == a[1] && b[2] == a[2] )  ? 0
			: (b[1] >= b[2] && b[1] > a[1] && b[1] > a[2] ) ? 1
			: (b[2] > b[1] && b[2] > a[1] && b[2] > a[2] ) ? 1
			: -1;
	}
	function order_2valsum(a, b) {
		return ( a[1]+a[2] ) == ( b[1]+b[2] ) ? 0
					: (b[1]+b[2]) > (a[1]+a[2])  ? 1
						: -1
	}
	function chop(body,limit) {
		return limit > 0 ? body.slice(0,limit)
			: limit < 0 ? body.slice(limit,body.length)
			: body;
	}

	function printf(str,term,month,tn) {
		str = str.replace("%d", term);
		str = str.replace("%m", month);
		str = str.replace("%tn", tn);
		return str;
	}
	function run_sum(body) {
		if (body.length > 0) {
			for (i = 1; i < body.length; i++) {
				for (j = 1; j < body[i].length; j++) {
					body[i][j]+=body[i-1][j];
				}
			}
			return body;
		} else {
			return body;
		}
	}
	function run_sum_files(body) {
		if (body.length > 0) {
			var newbody = new Array();
			body[0]=[body[0][0], body[0][1]-body[0][2]];
			for (i = 1; i < body.length; i++) {
				body[i]=[body[i][0], body[i-1][1]+body[i][1]-body[i][2]];
			}
			return body;
		} else {
			return body;
		}
	}
	function empty_data (header) {
		var data =[['']];
		for (i = 1; i < header[0].length; i++) {
			data[0][i] = 0;
		}
		return data;
	}

	function metric2Data(jsonData,header,fields) {
		if (jsonData.length == 0) return empty_data(header);

		return $.map(jsonData, function(n,i){
				var row = new Array();
				row.push(n[0]);
				for ( var idx in fields ) {
					// round makes 0 from null values
					row.push(Math.round(n[fields[idx]]));
				}
			   return [row];
			});
	}

	function data2Table(header, data) {
		// var dataTable = google.visualization.arrayToDataTable(header.concat(data));
		var dataTable = new google.visualization.DataTable();
		dataTable.addColumn('string', header[0][0]);
		for (i = 1; i < header[0].length; i++) {
			dataTable.addColumn('number',header[0][i]);
		}
		dataTable.addRows(data);
		var formatter = new google.visualization.NumberFormat(
			{ negativeColor: 'red', negativeParens: true, pattern: '###,###.#'});
		for (i = 0; i < data[0].length; i++) {
			formatter.format(dataTable, i);
		}
		return dataTable;
	}

	function getActiveOpts (div) {
		var e = document.getElementById(div);
		var idx = e.selectedIndex < 0 ? 0 : e.selectedIndex;
		return e.options[idx].value;
	}

	function fBytes(val) {
		if ( Math.abs(val) > 1073741824 ) {
			val = Math.round(val*10/1073741824)/10 + 'GB';
		} else if ( Math.abs(val) > 1048576 ) {
			val = Math.round(val*10/1048576)/10 + 'MB';
		} else if ( Math.abs(val) > 1024 ) {
			val = Math.round(val*10/1024)/10 + 'kB';
		}

		return val;
	}

	function tHeadSum(body,span) {
		$(span[0]).text(body[0].toFixed(0).replace(/(\d)(?=(\d{3})+$)/g, '$1,'));
		$(span[1]).text(body[3].toFixed(0).replace(/(\d)(?=(\d{3})+$)/g, '$1,'));
		$(span[2]).text(fBytes(body[1]));
		$(span[3]).text(body[2].toFixed(0).replace(/(\d)(?=(\d{3})+$)/g, '$1,'));
	}
	function tMerge(body,span) {
		$(span[0]).text(body[0][0] === "M" ? body[0][1].toFixed(0).replace(/(\d)(?=(\d{3})+$)/g, '$1,') : body[1] ? body[1][1].toFixed(0).replace(/(\d)(?=(\d{3})+$)/g, '$1,') : '0');
	}

	function newCommiters(body,span) {
		var authors="";
		var url = 'https://' + getProjectGurl(getActiveProject()) + '/commit/';
		var col=order_alpha(0);
		body.sort(col);
		for (i = 0; i < body.length; i++) {
			authors = authors + body[i][0] +
				( body[i][2]
					? ', <a href="' + url + body[i][2]  + '">' + body[i][1] + '</a><br/>'
					: ', ' + body[i][1] + '<br/>' );
		}
		$(span[0]).html( authors );
		$( "span#date_ftc" ).text( S['term'] );
	}

	function zeroes(cnt,type,zero) {
		return Array.apply(null, Array(cnt)).map(type,zero);
	}
	function areaStacked(data) {
		var pos = {}, cnt = 0;
		for ( var i in data ) {
			if ( !pos[data[i][1]] ) {
				cnt++;
				pos[data[i][1]] = cnt;
			}
		}
		if ( cnt == 0 ) {
			return [[["",""]],[["",0]]];
		}
		cnt++;

		var header = zeroes(cnt, String.prototype.valueOf,"");
		Object.keys(pos).forEach(function (key) {
				header[pos[key]] = key;
		})

		var lastX, stackData=[], row = zeroes(cnt,Number.prototype.valueOf,0);
		for ( var i in data ) {
			if ( lastX !== undefined && lastX !== data[i][0] || i==data.length ) {
				row[0]=lastX;
				stackData.push(row);
				row = zeroes(cnt,Number.prototype.valueOf,0);
			}
			row[pos[data[i][1]]] = Math.round(100*data[i][2])/100; // cannot be null - problem in Google graph?
			lastX = data[i][0];
		}
		row[0]=lastX;
		stackData.push(row);
		return [[header],stackData];
	}

	function init_graphs(actTID,Igrid) {
		var gv = google.visualization;
		var GST = new Array(); // reuse graph
		for ( var i in Conf[actTID] ) {
			var tabs = Conf[actTID][i][Igrid];
			for ( var j in tabs ) {
				if ( tabs[j][0] === 'oneNumber' ) {
					GST.push(0);
				} else {
					var graph, g_type = tabs[j][0];
					if ( g_type === 'Area' ) {
						graph = gv.AreaChart;
					} else if ( g_type === 'Column' ) {
						graph = gv.ColumnChart;
					} else if ( g_type === 'Pie' ) {
						graph = gv.PieChart;
					} else if ( g_type === 'Bubble' ) {
						graph = gv.BubbleChart;
					} else if ( g_type === 'Table' ) {
						graph = gv.Table;
					} else {
						alert('Unknown chart type');
					}
					GST.push(new graph(document.getElementById(tabs[j][1])));
				}
			}
		}
		return GST;
	}

	function drawDashboard(Project,term,excl_to) {
		gv = google.visualization;
		var Iurl = 0, Igrid = 1, actTID = S['tab'], month = term.toString().substring(0,7);
		var till_now = getActiveOpts("when_opt") ? thisMonth() : '';
		var tn = till_now ? ' - ' + till_now : '';

		if ( GS[actTID] == undefined ) {
			GS[actTID] = init_graphs(actTID,Igrid);
		}

		var g_idx=-1,data,transform,header,Data,url;
		for ( var i in Conf[actTID] ) {
			// FIXME - Data rename, reuse the variable
			for ( var j in Conf[actTID][i][Igrid] ) {
				g_idx++;
				if ( excl_to && g_idx < excl_to ) {
					continue;
				}
				if ( j == 0 ) {
					Data = getData("/api/p/" + encodeURIComponent(Project)
							+ printf(Conf[actTID][i][Iurl],term,month,tn));
				}
				var report = Conf[actTID][i][Igrid][j], g_opts=report[2];
				if ( report[0] == 'oneNumber' ) {
					report[1](Data,report[2]);
					break;
				}
				transform = report[5];
				if ( report[4] ) {
					header = report[3];
					data = metric2Data(Data, header, report[4]);
				} else if ( "_stack" in report[2] ) {
					var stacked = areaStacked(Data);
					header = stacked[0];
					data = stacked[1];
				} else {
					header = report[3];
					data = Data.length == 0 ? empty_data(header) : Data;
				}
				if ( transform ) { data=transform(data); }
				var Table = data2Table(header, data);
				var chart=GS[actTID][g_idx];
				if ( report[6] ) {
					report[6](chart,Table,g_idx);
				}
				if (typeof g_opts === "function") {
					g_opts=g_opts(data,month,tn);
				} else {
					g_opts['title'] = printf(g_opts['_t'],term,month,tn);
				}
				if (Data.length == 0) {
					g_opts['title'] = g_opts['title'].replace(/(\d)[^\d]*$/g, "$1 no data" )
				}
				chart.draw(Table, g_opts);
			}
		}
	}

	function githubSucc( response ) {
		var meta = response.meta;
		var data = response.data;
		var Msg = "No detail available.";
		if ( meta["X-RateLimit-Remaining"] == 0 ) {
			var d = new Date(0);
			d.setUTCSeconds(meta["X-RateLimit-Reset"]);
			Msg = 'No commit detail available from GitHub until ' + d.toString();
		} else {
			Msg = data['message'].replace(/\n\n/, "</h3><br /></br>");
			Msg = Msg.replace(/\n/g, "<br />");
			Msg = '<h4> '+ data['author']['name'] + ', <small>' + data['author']['date'] + '</small></h4><h3> ' + Msg;
			//</h3>
		}
		$( "div#popup_bod" ).html( Msg );
	}

	function getInfo(proj,value) {
		var url=proj.split(' (');
		var gurl = "https://api.github.com/repos/" + url[1].substring(0, url[1].length - 1)
			+ '/' + url[0] + "/git/commits/" + value;
		$.ajax({
			url: gurl,
			jsonp: "callback",
			dataType: "jsonp",
			success: githubSucc,
			error: function( e ) {
				$( "div#popup_bod" ).html( "Error: can't get commit detail" );
			}
		});
	}

	function dateListener(chart,table,pos) {
		google.visualization.events.removeAllListeners(chart);
		function selectHandler() {
			var selectedItem = chart.getSelection()[0];
			if (selectedItem && selectedItem.row !== null ) {
				S['term'] = table.getValue(selectedItem.row, 0);
				refresh(S['term'],pos+1);
			}
		}
		google.visualization.events.addListener(chart, 'select', selectHandler);
	}
	function dateListener1(c,t,pos) {
		dateListener(c,t,pos+1);
	}

	function commitListener(c,t) {
		var chart=c;
		var Table=t;
		google.visualization.events.removeAllListeners(c);
		function selectHandler() {
			var selectedItem = chart.getSelection()[0];
			if (selectedItem && selectedItem.row !== null ) {
				var value = Table.getValue(selectedItem.row, 0);
				if ( value === null ) {
					alert('Commit hash available in paid version only.');
				} else {
					var proj = getActiveProject();
					getInfo(proj,value);
					var url = 'https://' + getProjectGurl(proj,'') + '/commit/' + value;
					$( "span#popup_head" ).html( '<small>git show </small>' + value.substring(0, 11) );
					$( "span#popup_url" ).html( '<a class="btn btn-success" href="' + url
						+ '"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>' );
					$( "span#popup_url_out" ).html( '<a class="btn btn-success" href="' + url
						+ '" target="_blank"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span></a>' );
					$('#com_dialog').modal("show");
				}
			}
		}
		google.visualization.events.addListener(chart, 'select', selectHandler);
	}

	function getActiveProject () {
		var e = document.getElementById("project_div");
		return e.options[e.selectedIndex].value;
	}

	function getProjectGurl(Proj) {
		var url=Proj.split(' (');
		return 'github.com/' + url[1].substring(0, url[1].length - 1) + '/' + url[0];
	}

	function refresh(term,excl_to) {
		var Project = getActiveProject();
		drawDashboard(Project,term,excl_to);
		$( "span#github_url" ).html( '<a class="btn btn-sm btn-success" href="https://' + getProjectGurl(Project)
			+ '"><span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span></a>' );
	}
</script>
<style>
.vh25{ height: 27vh }
.vh30{ height: 30vh }
.vh33{ height: 33vh }
.vh50{ height: 50vh }
.lborder{ border-left: 1px solid #ccc; border-bottom: 1px solid #ccc; border-top: 1px solid #ccc; }
.tborder{ border-left: 1px solid #ccc; border-top: 1px solid #ccc; }
hr {
	height: 1px;
	background-color:#ccc;
}
</style>
</head>

<body style="padding: 56px 0px 0px 0px;">
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="navbar-header">
	  <select id="project_div" class="btn btn-success btn-lg dropdown-toggle"></select>
	  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	  </button>
	</div>
	<div class="collapse navbar-collapse">
		<div class="nav navbar-nav">
				&nbsp;<span id="github_url"></span>
				<a href="http://www.briskat.com"><img src="/assets/logo-s.png"></a>
		</div>
		<ul class="nav navbar-nav" id="dashtabs">
			<li class="dropdown">
			  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-equalizer" aria-hidden="true"></span> commits<span class="caret"></span></a>
			  <ul class="dropdown-menu">
				<li><a data-toggle="tab" href="#cact" id="rcact"> activity</a></li>
				<li><a data-toggle="tab" href="#csum" id="rcsum"> summary</a></li>
			  </ul>
			</li>
			<li class="dropdown">
			  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> contributors<span class="caret"></span></a>
			  <ul class="dropdown-menu">
				<li><a data-toggle="tab" href="#conact" id="rconact"> activity</a></li>
				<li><a data-toggle="tab" href="#concom" id="rconcom"> top commiters</a></li>
				<li><a data-toggle="tab" href="#conlin" id="rconlin"> top line changers</a></li>
				<li><a data-toggle="tab" href="#conaut" id="rconaut"> top size changers</a></li>
				<li role="separator" class="divider"></li>
				<li><a data-toggle="tab" href="#connew" id="rconnew"> newcomers</a></li>
			  </ul>
			</li>
			<li class="dropdown">
			  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-file" aria-hidden="true"></span> file<span class="caret"></span></a>
			  <ul class="dropdown-menu">
				<li><a data-toggle="tab" href="#fact" id="rfact"> activity</a></li>
				<li><a data-toggle="tab" href="#fmodcom" id="rfmodcom"> commits changing most files</a></li>
				<li><a data-toggle="tab" href="#fmodfil" id="rfmodfil"> most changed files</a></li>
			  </ul>
			</li>
			<li><a data-toggle="tab" href="#lact" id="rlact"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span> lines</a></li>
			<li class="dropdown">
			  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-cd" aria-hidden="true"></span> size<span class="caret"></span></a>
			  <ul class="dropdown-menu">
				<li><a data-toggle="tab" href="#sact" id="rsact"> activity</a></li>
				<li><a data-toggle="tab" href="#stype" id="rstype"> by extension</a></li>
			  </ul>
			</li>
		</ul>
	</div>
</div>
	<div class="modal fade" id="mainHelp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h2 class="modal-title" id="myModalLabel">Gitcharts analytics</h2>
				views changes in git repository. Contact us at <b>ask at briskat.com</b>.
		  </div>
		  <div class="modal-body text-left">
					<p>Project data are refreshed from github repositories each hour.
					Use green buttons to change project or select time period.
					Click GitHub button (next to Project button) to view original project on GitHub. On commit pane click particular commit to view commit detail.
					</p>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		  </div>
		</div>
	  </div>
	</div>

	<div class="tab-content">
		<div id="com_dialog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
		  <div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header text-center">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h3><span id="popup_head"></span></h3>
				</div>
				<div class="modal-body">
					<div id="popup_bod" class="text-left"></div>
				</div>
				<div class="modal-footer">
					<span id="popup_url"></span>
					<span id="popup_url_out"></span>
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		  </div>
		</div>
		<div class="col-lg-12 text-right">
			<div class="btn-group" role="group" id="btntab0">
					<select id="when_opt" class="btn btn-xs btn-success dropdown-toggle btn-block">
						<optgroup label="Report period:">
						<option value="">selected month only</option>
						<option value="now">all months till now</option>
						</optgroup>
					</select>
			</div> |
			<a class="btn btn-xs btn-default" href="https://github.com/briskat/briskat.github.io/issues/new">
			<span class="glyphicon glyphicon-pencil" aria-hidden="true">bug</span></a> |
			<button id="link_btn" type="button" class="btn btn-xs btn-default">
			<span class="glyphicon glyphicon-link" aria-hidden="true"></span>
			</button> |
			<button type="button" id="help_btn" class="btn btn-xs btn-default" data-toggle="modal" data-target="#mainHelp">
			<span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
			</button>
		</div>
		<p><br/></p>

		<div id="cact" class="tab-pane">
			<div id="cact_d1" class="vh30"></div>
			<div class="col-lg-6 tborder">
				<br/><div id="cact_d2" class="vh25"></div>
			</div>
			<div class="col-lg-6 tborder text-right">
				<a data-toggle="tab" href="#sact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
				<div id="cact_d3" class="vh25"></div>
			</div>
			<div class="col-lg-6 lborder text-right">
				<a data-toggle="tab" href="#fact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
				<div id="cact_d5" class="vh25"></div>
			</div>
			<div class="col-lg-6 lborder text-right">
				<a data-toggle="tab" href="#lact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
				<div id="cact_d4" class="vh25"></div>
			</div>
		</div>

		<div id="csum" class="tab-pane text-center">
			<div class="col-lg-3">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2><span id="csum_d1"></span> <small>commits</small></h2>
						( <b><span id="csum_d2"></span></b> merge commits )
						&nbsp;&nbsp;<a data-toggle="tab" href="#cact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
					</div>
				</div>
			</div>

			<div class="col-lg-3">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2><span id="csum_d3"></span> <small>contributors</small></h2>
						( <b><span id="csum_d4"></span></b> mergers )
						&nbsp;&nbsp;<a data-toggle="tab" href="#conact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
					</div>
				</div>
			</div>

			<div class="col-lg-3">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2>~<span id="csum_d5"></span></h2>
						<a data-toggle="tab" href="#fact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
					</div>
				</div>
			</div>

			<div class="col-lg-3">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2>~<span id="csum_d6"></span> <small>files</small></h2>
						<a data-toggle="tab" href="#sact"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a>
					</div>
				</div>
			</div>

			<div class="col-lg-12">
				<div id="csum_d7" class="vh33"></div><hr/>
			</div>
			<div class="col-lg-12">
				<div id="csum_d8" class="vh33"></div><hr/>
			</div>
		</div>

		<div id="conact" class="tab-pane">
			<div id="conact_d1" class="vh30"></div><hr/>
			<div id="conact_d2" class="vh50"></div>
		</div>
		<div id="concom" class="tab-pane">
			<div id="concom_d1" class="vh30"></div><br/>
			<div class="col-lg-6 lborder">
				<div id="concom_d2" class="vh50"></div>
			</div>
			<div class="col-lg-6 lborder">
				<div id="concom_d3" class="vh50"></div>
			</div>
		</div>
		<div id="conlin" class="tab-pane">
			<div id="conlin_d1" class="vh30"></div><hr/>
			<div id="conlin_d2" class="vh50"></div>
		</div>
		<div id="conaut" class="tab-pane">
			<div id="conaut_d1" class="vh30"></div><hr/>
			<div id="conaut_d2" class="vh50"></div>
		</div>
		<div id="connew" class="tab-pane">
			<div id="connew_d1" class="vh30"></div><hr/>
			<div class="text-center vh50">
					<h5><b><span id="date_ftc"></span>, first time contributors</b></h5>
					<span id="connew_d2"></span>
			</div>
		</div>

		<div id="lact" class="tab-pane">
			<div id="lact_d1" class="vh30"></div><br/>
			<div class="col-lg-7 lborder">
				<div id="lact_d2" class="vh50"></div>
			</div>
			<div class="col-lg-5 lborder">
				<div id="lact_d3" class="vh50"></div>
			</div>
		</div>

		<div id="fact" class="tab-pane">
			<div class="col-lg-7 tborder">
				<div id="fact_d1" class="vh30"></div>
			</div>
			<div class="col-lg-5 tborder">
				<div id="fact_d2" class="vh30"></div>
			</div>
			<div class="col-lg-7 lborder">
				<div id="fact_d3" class="vh50"></div>
			</div>
			<div class="col-lg-5 lborder">
				<div id="fact_d4" class="vh50"></div>
			</div>
		</div>
		<div id="fmodcom" class="tab-pane">
			<div id="fmodcom_d1" class="vh30"></div><br/>
			<div class="col-lg-7 lborder">
				<div id="fmodcom_d2" class="vh50"></div>
			</div>
			<div class="col-lg-5 lborder">
				<div id="fmodcom_d3" class="vh50"></div>
			</div>
		</div>
		<div id="fmodfil" class="tab-pane">
			<div id="fmodfil_d1" class="vh30"></div><br/>
			<div class="col-lg-7 lborder">
				<div id="fmodfil_d2" class="vh50"></div>
			</div>
			<div class="col-lg-5 lborder">
				<div id="fmodfil_d3" class="vh50"></div>
			</div>
		</div>

		<div id="sact" class="tab-pane">
			<div class="col-lg-7 tborder">
				<div id="sact_d1" class="vh30"></div>
			</div>
			<div class="col-lg-5 tborder">
				<div id="sact_d2" class="vh30"></div>
			</div>
			<div class="col-lg-7 lborder">
				<div id="sact_d3" class="vh50"></div>
			</div>
			<div class="col-lg-5 lborder">
				<center>
				<div id="sact_d4" class="vh50"></div>
				</center>
			</div>
		</div>
		<div id="stype" class="tab-pane">
			<div id="stype_d1" class="vh30"></div><br/>
			<div class="col-lg-6 lborder">
				<div id="stype_d3" class="vh50"></div>
			</div>
			<div class="col-lg-6 lborder">
				<div id="stype_d2" class="vh50"></div>
			</div>
		</div>
	</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57810258-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
